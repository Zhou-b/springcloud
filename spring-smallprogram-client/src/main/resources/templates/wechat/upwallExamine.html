<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
    <title>i情音 上墙审核</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="/static/wechat/js/jquery.min.js"></script>
    <script src="/static/wechat/js/jquery.dataTable.js"></script>
    <link href="/static/wechat/css/jquery-confirm.css" rel="stylesheet" media="screen">
    <script src="/static/wechat/js/jquery-confirm.js" type="text/javascript"></script>

    <style>
        .center{
            margin:100px auto;
        }
    </style>
</head>
<body>
    <h4>列表</h4>
    <div>
        <select id="statusSelect" onchange="select()">
            <option value="">全部</option>
            <option value="ACTIVE">活动中</option>
            <option value="DELETE">已删除</option>
        </select>
        <select id="examineStatusSelect" onchange="select()">
            <option value="">全部</option>
            <option value="0">未审核</option>
            <option value="1">审核失败</option>
            <option value="2">审核成功但未发布</option>
            <option value="3">已发布</option>
        </select>
    </div>
    <table id="table" class="center"></table>

<script>
    function isEmpty(val){
        return val == null || val == "" || val == undefined;
    }
    //https://gitee.com/PoppinRubo/jquery.dataTable
    $("#table").dataTable({
        debug: true,
        check: false,//多选框
        serial:false,//序列号
        pageCapacity:15,
        loading:false,
        oddEven:false,
        url: "/wechat/getUpWallInfoList",
        style: {"font-size": "12px", "width": "800px"},
        align:"center",
        ButtonStyle:{fontColor:"#ffffff",backgroundColor:"#10AA9C"},
        columns: [
            {ColumnName: "id", title: "ID", width: 30},
            {ColumnName: "name", title: "姓名", width: 80},
            {ColumnName: "sex", title: "性别", width: 40, custom: function (data) {
                    if(data == 0){return "女"; }
                    else if(data == 1){ return "男"; }
                    else{ return "未知"; }
                }},
            {ColumnName: "wechat", title: "微信号", width: 100},
            {ColumnName: "baseInfo", title: "年龄 身高 星座 职业 混迹区", width: 170},
            {ColumnName: "interest", title: "兴趣爱好", width: 120},
            {ColumnName: "selfIntroduction", title: "自我介绍", width: 120},
            {ColumnName: "demand", title: "交友要求", width: 120},
            {ColumnName: "imgUrls", title: "所有图片", width: 50},
            {ColumnName: "examineStatus", title: "审核状态", width: 80, custom:function(data){
                    if(data == '0'){return "未审核"; }
                    else if(data == '1'){ return "审核失败"; }
                    else if(data == '2'){ return "<span style='color:red;'>审核成功但未发布</span>"; }
                    else if(data == '3'){ return "已发布"; }
                }},
            {ColumnName: "examineTime", title: "审核时间", width: 120},
            {ColumnName: "publishTime", title: "发布时间", width: 120},
            {ColumnName: "createTime", title: "创建时间", width: 120},
            {ColumnName: "createUserIp", title: "ip", width: 70},
            // {ColumnName: "imgUrls", img:true, title: "图片", width: 40},//img:true,后台数据反回图片url这一列就生成图片显示
            {title: "查看", button: "show", buttonName: "查看", width: 50},//自定义的按钮
            {title: "审核", button: "examine", buttonName: "审核", width: 50, custom: function (data, row) {
                    if(row.examineStatus != 0 && row.examineStatus != 2){
                        return "不可操作";
                    }
                }},
            {title: "操作", button: "del", buttonName: "删除", width: 50, custom: function (data, row) {
                    if(row.status == 'DELETE'){
                        return "不可操作";
                    }
                }}
        ],
        Click: function (row) {//内置事件行单击
            // alert("单击："+row.id);
        },
        doubleClick: function (row) {//内置事件行双击事件
            // alert("双击："+row.id);
        }
        ,
        delClick:function(row){
            $.confirm({
                title: '提示',
                content: "确认删除吗？",
                confirmButton: '确认',
                cancelButton: '取消',
                closeIcon: true,
                confirmButtonClass: 'btn-primary',
                confirm: function(){
                    $.ajax({
                        url: '/wechat/updateUpWallExamine',
                        type: 'POST',
                        data: {id : row.id, examineStatus: 1, status:'DELETE'}
                    }).done(function(res) {
                        console.log(res);
                        if(res.resultCode == 200){
                            $.alert("删除成功");
                            $('#table').TableRefresh();
                        }else{
                            $.alert(res.resultInfo);
                        }
                    }).fail(function(res) {
                        $.alert("请求失败");
                    });
                },
                cancel: function(){
                }
            });
        },
        examineClick: function (row) {//自定义按钮事件，事件名是上面设置的按钮名+Click
            // alert("自定义编辑："+row.id);
            if(row.examineStatus != 0 && row.examineStatus != 2){
                $.alert("状态不可变更");
                return;
            }
            //弹个框，选 审核是否通过
            $.confirm({
                title: '审核!',
                content: function(){
                    var select = "审核信息:" + row.name +
                                 ":<select id='examineStatus'><option value='1'>审核失败</option><option value='2'>审核成功但未发布</option><option value='3'>已发布</option></select>";
                    this.setContent(select);
                },
                confirmButton: '确认',
                cancelButton: '取消',
                closeIcon: true,
                confirmButtonClass: 'btn-primary',
                confirm: function(){
                    $.ajax({
                        url: '/wechat/updateUpWallExamine',
                        type: 'POST',
                        data: {id : row.id, examineStatus: $("#examineStatus").val()}
                    }).done(function(res) {
                        console.log(res);
                        if(res.resultCode == 200){
                            $('#table').TableRefresh();
                        }else{
                            $.alert(res.resultInfo);
                        }
                    }).fail(function(res) {
                        $.alert("请求失败");
                    });
                },
                cancel: function(){
                }
            });
        }
        ,
        showClick: function (row) {
            // alert("自定义查看："+row.name);
            //去页面
            window.open("/wechat/getUpWallExamineDetailPage?id=" + row.id);
        }
    });


    function select() {
        $("#table").dataTable({
            url: "/wechat/getUpWallInfoList?status=" + $("#statusSelect").val() + "&examineStatus=" + $("#examineStatusSelect").val()
        })
    }

</script>
</body>
</html>